generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model WatchlistItem {
  id          String   @id @default(cuid())
  type        String
  title       String
  status      String   @default("PLAN_TO_WATCH")
  externalId  String   @map("external_id")
  imageUrl    String?  @map("image_url")
  rating      Float?
  year        Int?
  episodes    Int?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@unique([externalId, type])
  @@index([type])
  @@index([status])
  @@index([createdAt])
  @@map("watchlist_items")
}


model StockQuote {
  symbol        String   @id
  companyName   String?  @map("company_name")
  logoUrl       String?  @map("logo_url")
  currentPrice  Float    @map("current_price")
  change        Float
  percentChange Float    @map("percent_change")
  lastUpdated   DateTime @default(now()) @map("last_updated")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@index([lastUpdated])
  @@map("stock_quotes")
}

model DailyQuote {
  date      String   @id
  content   String   @db.Text
  author    String
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("daily_quotes")
}

model CryptoQuote {
  symbol           String   @id
  name             String
  logoUrl          String?  @map("logo_url")
  price            Float
  percentChange24h Float?   @map("percent_change_24h")
  lastUpdated      DateTime @default(now()) @map("last_updated")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  @@index([lastUpdated])
  @@map("crypto_quotes")
}

model TopItem {
  id          String   @id
  type        String   // 'anime' | 'movie' | 'show'
  title       String
  imageUrl    String   @map("image_url")
  year        Int?
  rating      Float
  episodes    Int?
  externalId  Int      @map("external_id")
  lastUpdated DateTime @default(now()) @map("last_updated")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@unique([externalId, type])
  @@index([type])
  @@index([lastUpdated])
  @@map("top_items")
}

model Game {
  id          String   @id @default(cuid())
  title       String
  status      String   @default("PLAN_TO_PLAY")
  externalId  String   @map("external_id")
  imageUrl    String?  @map("image_url")
  rating      Float?
  released    String?  // Release date as string (YYYY-MM-DD format)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@unique([externalId])
  @@index([status])
  @@index([createdAt])
  @@map("games")
}

model TopGame {
  id          String   @id
  title       String
  imageUrl    String   @map("image_url")
  rating      Float
  released    String?  // Release date as string (YYYY-MM-DD format)
  externalId  Int      @map("external_id")
  lastUpdated DateTime @default(now()) @map("last_updated")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@unique([externalId])
  @@index([lastUpdated])
  @@map("top_games")
}

model ApiUsage {
  id          String   @id @default(cuid())
  apiName     String   @map("api_name") // 'finnhub', 'coinmarketcap', 'rawg', 'tmdb', 'jikan', 'espn', 'openweather'
  endpoint    String?  // Optional endpoint path
  timestamp   DateTime @default(now())
  success     Boolean  @default(true)
  statusCode  Int?     @map("status_code")
  createdAt   DateTime @default(now()) @map("created_at")

  @@index([apiName, timestamp])
  @@index([timestamp])
  @@map("api_usage")
}

model Collection {
  id          String   @id @default(cuid())
  name        String
  description String?  @db.Text
  imageUrl    String?  @map("image_url")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  items       CollectionItem[]

  @@index([name])
  @@map("collections")
}

model CollectionItem {
  id           String     @id @default(cuid())
  collectionId String     @map("collection_id")
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  seriesId     String?    @map("series_id") // Komga series ID
  bookId       String?    @map("book_id")   // Komga book ID
  phase        String?    // Phase/group name (e.g., "Avengers World", "Infinity")
  order        Int        // Reading order within the collection
  createdAt    DateTime   @default(now()) @map("created_at")

  @@index([collectionId, order])
  @@index([seriesId])
  @@index([bookId])
  @@map("collection_items")
}
